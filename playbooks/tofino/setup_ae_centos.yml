# Copyright (c) 2019 Cable Television Laboratories, Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
#Import playbook

- hosts: all
  gather_facts: no
  become: yes
  tasks:
  - name: Install yum dependencies for AE base image
    yum:
      name:
        - tcpdump
        - vim
        - wget
        - java-1.8.0-openjdk
        - git
        - gcc
        - gcc-c++
        - bison
        - flex
        - libpcap-devel
        - qt-devel
        - gtk3-devel
        - rpm-build
        - libtool
        - c-ares-devel
        - qt5-qtbase-devel
        - qt5-qtmultimedia-devel
        - qt5-linguist
        - desktop-file-utils
        - openssl-devel
        - bzip2-devel
        - libffi-devel
        - libgcrypt-devel

  - name: Install pre-dependencies for specific version of Wireshark for AE base image
    shell: |
          cd /home/centos;
          wget https://www.wireshark.org/download/src/all-versions/wireshark-3.2.6.tar.xz;
          tar -xf wireshark-3.2.6.tar.xz;
          cd wireshark-3.2.6/tools;
          ./rpm-setup.sh

  - name: Install specific version of CMake for AE base image
    shell: |
            cd /home/centos;
            wget https://cmake.org/files/v3.5/cmake-3.5.2.tar.gz;
            tar xvf cmake-3.5.2.tar.gz;
            cd cmake-3.5.2;
            ./bootstrap --prefix=/usr;
            make install;
            cmake --version



  - name: Install specific version of Wireshark for AE base image
    shell: |
            cd /home/centos;
            mkdir build;
            cd build;
            cmake ../wireshark-3.2.6;
            make;
            make install

  - name: Download and install a specific version of Python for AE base image
    shell: |
            cd /home/centos;
            curl -O https://www.python.org/ftp/python/3.8.5/Python-3.8.5.tgz;
            tar -xzf Python-3.8.5.tgz;
            cd Python-3.8.5/;
            ./configure --enable-optimizations;
            make altinstall;
            ln -s /usr/local/bin/python3.8 /usr/bin/python3


  - name: Download and install a Open Distro for Elasticsearch v1.10.1-1 for AE base image
    shell: |
        cd /home/centos;
        yum install opendistroforelasticsearch-1.10.1-1


